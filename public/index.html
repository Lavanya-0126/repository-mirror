<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Repository Analyzer</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 40px;
      background: #ffffff;
      color: #000;
    }

    h1 {
      font-size: 36px;
      margin-bottom: 20px;
    }

    input {
      width: 500px;
      padding: 8px;
      font-size: 14px;
    }

    button {
      padding: 8px 16px;
      font-size: 14px;
      margin-left: 8px;
      cursor: pointer;
    }

    .result {
      margin-top: 30px;
      line-height: 1.6;
      white-space: pre-wrap;
    }

    .section-title {
      font-weight: bold;
      margin-top: 20px;
    }

    ul {
      margin-top: 8px;
    }
  </style>
</head>

<body>
  <h1>Repository Analyzer</h1>

  <input
    type="text"
    id="repo"
    placeholder="https://github.com/username/repository"
  />
  <button onclick="analyzeRepo()">Analyze</button>

  <div class="result" id="result"></div>

  <script>
    async function analyzeRepo() {
      const repoUrl = document.getElementById("repo").value;
      const resultDiv = document.getElementById("result");

      resultDiv.innerHTML = "Analyzing repository...";

      try {
        const response = await fetch("/api/analyze", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ repo: repoUrl })
        });

        const data = await response.json();

        if (data.error) {
          resultDiv.innerHTML = "Error: " + data.error;
          return;
        }

        // Format output
        resultDiv.innerHTML = formatResult(data.result);

      } catch (err) {
        resultDiv.innerHTML = "Server error. Please try again.";
      }
    }

    function formatResult(text) {
      // Convert roadmap bullets to list
      let formatted = text
        .replace(/Score:\s*(\d+\/\d+)/g, "<div class='section-title'>Score:</div>$1")
        .replace(/Summary:/g, "<div class='section-title'>Summary:</div>")
        .replace(/Roadmap:/g, "<div class='section-title'>Roadmap:</div><ul>")
        .replace(/â€¢\s*(.*)/g, "<li>$1</li>")
        .replace(/- (.*)/g, "<li>$1</li>");

      if (formatted.includes("<ul>")) {
        formatted += "</ul>";
      }

      return formatted;
    }
  </script>
</body>
</html>
